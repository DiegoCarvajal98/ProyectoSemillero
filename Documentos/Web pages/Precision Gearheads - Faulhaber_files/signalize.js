!function(){class t{static urlB64ToUint8Array(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(e),s=new Uint8Array(i.length);for(let t=0;t<i.length;++t)s[t]=i.charCodeAt(t);return s}static isSupported(){return!!t.isSupportedSafari()||"serviceWorker"in navigator&&"PushManager"in window&&!(!navigator.serviceWorker||!window.PushManager)}static isSupportedSafari(){return"safari"in window&&"object"==typeof window.safari&&"pushNotification"in window.safari}static async hasServiceWorker(){return!!t.isSupportedSafari()||t.isSupported()&&null!=await navigator.serviceWorker.getRegistration()}static async getStatus(){return await Notification.permission}static getNotificationStatus(){return Notification.permission}static async getActiveSubscription(e){if(t.isSupported()&&"granted"===await t.getStatus())try{let i=await navigator.serviceWorker.getRegistration();if(!i&&(i=await t.registerServiceWorker("/sw.js"),!i))return;let s=await i.pushManager.getSubscription();return!s&&e&&(await t.subscribeUser(i,e,"https://api.signalize.com"),s=await i.pushManager.getSubscription()),s}catch(e){console.warn("Error fetching the active subscription: ",e)}}static async registerServiceWorker(e="sw.ejs"){if(t.isSupported())try{const t=await navigator.serviceWorker.getRegistration();if(void 0!==t&&t.active.scriptURL.includes("url[]=https%3A%2F%2Fapi.signalize.com%2Fserviceworker.js"))return t;const i=await navigator.serviceWorker.register(e);return await navigator.serviceWorker.ready,i}catch(e){console.warn("registerServiceWorker failed!")}}static async subscribeUser(e,i,s){const a=await t.getPublicKeyArray(i,s);try{return await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:a})}catch(e){console.warn("subscribeUser failed: ",e)}return!1}static async subscribeUserV2(e,i){try{return t.isSupportedSafari()?new Promise((t=>{window.safari.pushNotification.requestPermission("https://safari.signalize.com/safari-api",e.pushId,{clientId:e.userId,websiteUrl:window.location.protocol+"//"+window.location.host},(e=>{console.log("Safari-Result:"),console.log(e),t(!0)}))})):await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i})}catch(e){console.warn("subscribeUser failed: ",e)}return!1}static async reSubscribe(e,i,s){await t.disable();const a=await t.enableV2(e,i,s,"https://api.signalize.com");await t.subscribeUserV2(a.serviceWorker,a.serverKey)}static async deleteServiceWorkers(){if(window.navigator&&navigator.serviceWorker){const t=await navigator.serviceWorker.getRegistrations();for(let e of t)await e.unregister()}}static async sendSubscriptionToServer(e,i,s){if(t.isSupportedSafari())return!0;const a=await t.getActiveSubscription(i);if(a){const t=JSON.parse(JSON.stringify(a)),r={endpoint:t.endpoint,key:t.keys.p256dh,auth:t.keys.auth,language:navigator.language},n={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},o=await fetch(`${e}/v3/accounts/${i}/web/subscriptions/${s}`,n);return 200<=o.status&&300>o.status}return!1}static async deleteSubscriptionFromServer(t,e,i){const s=await fetch(`${t}/v3/accounts/${e}/web/subscriptions/${i}`,{method:"DELETE"});return 200<=s.status&&300>s.status}static async enable(e,i,s,a="https://api.signalize.com"){if(t.isSupported()){console.warn("NotiParrot.enable is deprecated, use enableV2 instead!");const r=t.getNotificationStatus();if("denied"==r)return console.warn("Client doesn't want push!"),!1;if("granted"==r&&await t.hasServiceWorker())return console.warn("Push already registered!"),!1;if("granted"==r||"default"==r)try{const n=await t.registerServiceWorker(e);if(n)return await t.subscribeUser(n,i,a),"default"===r&&window.localStorage&&window.localStorage.removeItem("notiParrotLastSent"),await t.sendSubscriptionToServer(a,i,s)}catch(e){console.error("Service Worker Error",e)}}return!1}static async enableV2(e,i,s,a="https://api.signalize.com"){if(t.isSupported()){const r=await t.getStatus(i);if("denied"==r)return void console.warn("Client doesn't want push!");if("granted"==r&&await t.hasServiceWorker())return void console.warn("Push already registered!");if("granted"==r||"default"==r)try{if(t.isSupportedSafari()){const e=await t.getSafariPushId(a,i);return e?{serviceWorker:{pushId:e,userId:s},serverKey:"0"}:void 0}const r=await t.registerServiceWorker(e);if(r){return{serviceWorker:r,serverKey:await t.getPublicKeyArray(i,a)}}}catch(e){console.error("Service Worker Error",e)}}}static async disable(){return t.isSupportedSafari()?void console.warn("NotiParrot.disable not supported on safari!"):void await this.deleteServiceWorkers()}static async getPublicKeyArray(e,i){const s=await fetch(i+"/api/v1/push/key/get-current/"+e).then((t=>t.text()));return t.urlB64ToUint8Array(s)}static async getLocalPublicKeyArray(){const t=await navigator.serviceWorker.getRegistration();if(t){const e=await t.pushManager.getSubscription();if(e&&e.options&&e.options.applicationServerKey)return new Uint8Array(e.options.applicationServerKey)}}static async getSafariPushId(e,i){if(!t.safariPushId){const s=await fetch(`${e}/api/v1/safari/push-ids/${i}`);200==s.status&&(t.safariPushId=await s.text())}return t.safariPushId}}class e{static isSupported(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window}constructor(t,e,i){this.accountId=parseInt(t),this.userId=e,this.iframeHost=i,this.iframeId="63b6e216-a08f-11e8-98d0-529269fb1459",this.popupWindow=void 0,this.popupWidth=500,this.popupHeight=338,window.addEventListener("message",(t=>this.handleMessage(t))),this.messageCallback=void 0}generateUrl(){const t=encodeURIComponent(this.userId);return`${this.iframeHost}?accountId=${this.accountId}&userId=${t}&origin=${location.origin}`}async getIframeStatus(){const t=this.waitForMessage("status"),e=document.createElement("iframe");e.setAttribute("id",this.iframeId),e.setAttribute("width",0),e.setAttribute("height",0),e.setAttribute("hidden","hidden"),e.setAttribute("src",this.generateUrl()),document.body.appendChild(e);const i=await t,s=document.getElementById(this.iframeId);return s.parentNode.removeChild(s),i}async enable(t){if(this.popupWindow)return"opened";const e=(screen.availLeft||0)+(screen.width-this.popupWidth)/2,i=(screen.height-this.popupHeight)/2-32,s=this.waitForMessage("status");this.popupWindow=window.open(this.generateUrl(),"PushPopup",`width=${this.popupWidth}, height=${this.popupHeight}, top=${i}, left=${e}`),await s;const a=setInterval((()=>{this.popupWindow.closed&&this.messageCallback&&(this.messageCallback({type:"enable",data:"closed"}),this.popupWindow=void 0)}),1e3),r=await this.sendMessage(this.popupWindow,"enable",t);return clearInterval(a),this.clearMessageCallback(),r}closePopup(){this.popupWindow&&"function"==typeof this.popupWindow.close&&this.popupWindow.close(),this.popupWindow=void 0}async getStatus(){const t=window.Notification.permission,e=await this.getIframeStatus();return"denied"==t?e:"granted"==e?"granted":"default"}async sendMessage(t,e,i){if(!t)return!1;const s=this.waitForMessage(e);return t.postMessage({type:e,data:i},this.iframeHost),s}handleMessage(t){t.origin!==this.iframeHost||"function"==typeof this.messageCallback&&this.messageCallback(t.data)&&this.clearMessageCallback()}waitForMessage(t){return"function"==typeof this.messageCallback?void 0:new Promise((e=>{this.messageCallback=i=>{if(i.type===t)return e(i.data),!0}}))}clearMessageCallback(){this.messageCallback=void 0}}class i{constructor(t,e){this.data={},this.allowedCheck=e,this.realStorage=t?window.localStorage:window.sessionStorage,this.realStorage||(this.allowedCheck=()=>!1)}setItem(t,e){this.allowedCheck()?this.realStorage.setItem(t,e):this.data[t]=e+""}getItem(t){return this.allowedCheck()?this.realStorage.getItem(t):this.data[t]}removeItem(t){delete this.data[t],this.realStorage&&this.realStorage.removeItem(t)}}window.et_signalize=new class{constructor(e="https://api.signalize.com"){this.NotiParrot=t,this.accountId=parseInt("476522"),this.accountToken="XOBVL9b",this.apiUrl=e,this.swPath="/sw.js",this.et=window._etracker,this.notiParrotFrame=void 0,this.registration=void 0,this.cookiesAllowed=()=>!(!this.et||!this.et.areCookiesEnabled||!this.et.areCookiesEnabled()),this.sessionStorage=new i(!1,(()=>this.cookiesAllowed())),this.localStorage=new i(!0,(()=>this.cookiesAllowed())),this.isIPhone=/iPhone/.test(navigator.userAgent),this.language=window.et_la||navigator.language,this.pushSubdomain=window.et_optInPushDomain,this.hasOptInPushDomain=!!window.et_hasOptInPushDomain,this.useNativeOptIn=!!window.et_optInNative,this.refreshClientId()}refreshClientId(){this.clientId=this.et&&this.et.getCoid&&this.et.getCoid(),this.clientId||(this.clientId=this.generateClientId())}generateClientId(){let t="";const e=window.crypto||window.msCrypto,i=new Uint8Array(16);e.getRandomValues(i);for(let e=0;e<i.length;++e)t+=(16>i[e]?"0":"")+i[e].toString(16);return t}getClientId(){return this.clientId}getInterests(){let t="";const e=document.forms["et-promote-interests"].elements.SIGNALIZE_INTEREST;return e&&(t=[...e].filter((t=>t.checked)).map((t=>t.value)).join(", ")),t||"STR_CC_ATTR_VALUE_NO_ALLOCATION"}sendSelectedInterests(){if(document.getElementById("et-promote-interests-active")){const t=et_SignalizeInterestEvent(this.getInterests(),"Web Push","web push interests chosen");this.et.sendEvent(t)}}blockOptInPush(t,e){e=e||"Box";let i="user blocks opt-in dialog for a month";("boolean"==typeof(t=t||30)||1===t)&&(t=1,i="user blocks opt-in dialog for session"),this.setOptInPushCookie("no",t),this.et.sendEvent(et_SignalizeOptInEvent("Opt-In - "+e,"Web Push",i))}stopPushOptInOverlay(){"function"==typeof window.et_stopOptInPushOverlay&&window.et_stopOptInPushOverlay()}setOptInPushCookie(t,e){if(window.et_getDefaultCookieDomain&&window.et_setCookieValue){var i=et_getDefaultCookieDomain();et_setCookieValue("et_oip",t,e,i,1<e)}}async enableNativePushOptIn(t,e=!1){t=t||"Banner",this.registration||(this.registration=await this.NotiParrot.enableV2(this.swPath,this.accountId,this.clientId,this.apiUrl));const i=await this.NotiParrot.subscribeUserV2(this.registration.serviceWorker,this.registration.serverKey);i&&(this.et.enableCookies(),this.refreshClientId(),this.localStorage.setItem("signalizeIsSubscriber",!0)),this.NotiParrot.sendSubscriptionToServer(this.apiUrl,this.accountToken,this.clientId),this.et.sendEvent(et_SignalizeOptInEvent("Native Opt-In - "+t,"Web Push","web push status set to "+!!i)),e&&i||this.stopPushOptInOverlay(),!e&&i&&this.sendSelectedInterests()}async showNativePushOptIn(){this.registration=await this.NotiParrot.enableV2(this.swPath,this.accountId,this.clientId,this.apiUrl),this.registration&&this.showBanner(!0)}async showPopupPushOptIn(){!window.et_getCookieValue("et_oip",!0)&&(this.notiParrotFrame=new e(this.accountId,this.clientId,"https://"+this.pushSubdomain),"default"===await this.notiParrotFrame.getStatus()&&this.showBanner(!1))}async enablePopupPushOptIn(t){t=t||"Box",this.et.sendEvent(et_SignalizePopUpEvent("Pop-Up - "+t,"Web Push","popup opens")),this.notiParrotFrame||(this.notiParrotFrame=new e(this.accountId,this.clientId,"https://"+this.pushSubdomain));try{const e=window.et_getPopUpTexts(),i=await this.notiParrotFrame.enable(e);this.et.sendEvent(et_SignalizePopUpEvent(`Pop-Up - ${t}`,"Web Push",`web push status set to ${i}`)),"granted"===i?(this.et.sendEvent(et_SignalizePopUpEvent(`Pop-Up - ${t}`,"Web Push","subscribed")),this.et.enableCookies(),this.sendSelectedInterests()):"denied"===i&&et_blockOptInPushWithBanner(30,t),this.stopPushOptInOverlay(),this.notiParrotFrame.closePopup()}catch(t){console.error("Error opening popup: ",t),this.stopPushOptInOverlay(),this.notiParrotFrame.closePopup()}}showBanner(t=!1){var e=window.cc_url||window.et_url||document.location.href,i=t?"&oneStep=true":"";et_createScriptTag(this.apiUrl+"/banners/accounts/"+this.accountId+"?url="+encodeURIComponent(e)+"&lang="+this.language+i)}async checkMatchingWebKeys(){const t=await this.NotiParrot.getPublicKeyArray(this.accountId,this.apiUrl),e=await this.NotiParrot.getLocalPublicKeyArray();if(!t||!e||t.byteLength!=e.byteLength)return!1;for(let i=0;i<e.length;++i)if(e[i]!=t[i])return!1;return!0}shouldCheckSubscription(){if(!this.useNativeOptIn)return!1;const t=!!this.sessionStorage.getItem("signalizeSubscriptionChecked");return this.sessionStorage.setItem("signalizeSubscriptionChecked",!0),!t}async runWeb(){let t=await this.NotiParrot.getStatus();"granted"!=t&&(!this.hasOptInPushDomain&&this.useNativeOptIn||this.NotiParrot.isSupportedSafari()?await this.showNativePushOptIn():(this.notiParrotFrame=new e(this.accountId,this.clientId,"https://"+this.pushSubdomain),t=await this.notiParrotFrame.getStatus(),"granted"!=t&&(this.useNativeOptIn?await this.showNativePushOptIn():await this.showPopupPushOptIn(this.apiUrl,this.accountId,"https://"+this.pushSubdomain,et_la)))),"granted"===t?this.shouldCheckSubscription()&&(this.localStorage.setItem("signalizeIsSubscriber",!0),!await this.checkMatchingWebKeys()&&await this.NotiParrot.reSubscribe(this.swPath,this.accountId,this.clientId),this.NotiParrot.sendSubscriptionToServer(this.apiUrl,this.accountToken,this.clientId)):this.localStorage.getItem("signalizeIsSubscriber")&&(await this.NotiParrot.deleteSubscriptionFromServer(this.apiUrl,this.accountToken,this.clientId),this.localStorage.removeItem("signalizeIsSubscriber"))}async runWallet(){/^de\b/i.test(navigator.language)&&this.showBanner()}async run(){if(!window.et_getCookieValue("et_oip",!0))try{if(this.NotiParrot.isSupported())return await this.runWeb();if(this.isIPhone)return await this.runWallet()}catch(t){console.log("signalize failed: ",t)}}}(_etracker.getConfigValue("signalizeApiUrl")),!1!==window._etracker.getConfigValue("signalizeAutoStart")&&window.et_signalize.run().then((()=>{})).catch((t=>console.error(t))),(()=>{const t=document.location.href.split("#");t[1]&&"showOptIn"===t[1]&&window.et_signalize.showBanner()})(),window.et_openNativeOptIn=(t,e,i)=>window.et_signalize.enableNativePushOptIn(i,!1),window.et_openNativeOptInForMobile=(t,e,i)=>window.et_signalize.enableNativePushOptIn(i,!0),window.et_showBanner=(t,e,i,s)=>window.et_signalize.showBanner(s),window.et_enablePush=t=>window.et_signalize.enablePopupPushOptIn(t),window.et_sendInterests=()=>window.et_signalize.sendSelectedInterests(),window.et_blockOptInPush=(t,e)=>window.et_signalize.blockOptInPush(t,e),window.et_setOptInPushCookie=(t,e)=>window.et_signalize.setOptInPushCookie(t,e),window.et_SignalizeOptInEvent=(t,e,i)=>window.et_GenericEvent("signalizeOptIn",1,{object:t,category:e,action:i}),window.et_SignalizePopUpEvent=(t,e,i)=>window.et_GenericEvent("signalizePopUp",1,{object:t,category:e,action:i}),window.et_SignalizeInterestEvent=(t,e,i)=>window.et_GenericEvent("signalizeInterest",1,{object:t,category:e,action:i})}();